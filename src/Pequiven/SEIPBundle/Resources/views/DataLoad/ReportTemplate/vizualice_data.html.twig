{% trans_default_domain 'PequivenSEIPBundle' %}
<style>
    
    .white-gradient {
        background-color: #535353;
        color: #ffffff;
    }
    .header {
        text-align: left;
        font-size: 12px;
    }
    .text-center {
        text-align: center;
    }
    .header-tr {
        border-bottom: #E4E7EB;
        border-style: solid;
        border-bottom-style: dotted;
    }
    .content {
        color: #4a4a4a;
        font-size: 10px;
    }
    
</style>
{% if productsReport is not empty %}
         <div class="columns">
             {% if showDay  %}
             <div class="six-columns twelve-columns-mobile">
                <table class="simple-table responsive-table responsive-table-on">
                    <thead>
                        <tr>
                            <th class="text-center white-gradient"  colspan="5">DÍA</th>
                        </tr>
                        <tr class="header-tr">
                            <th  style="width: 20%" class="header">PRODUCTO</th>
                            <th  style="width: 20%" class="header">PPTO</th>
                            <th  style="width: 20%" class=" header">REAL</th>
                            <th  style="width: 20%" class=" header">EJEC&nbsp;(%)</th>
                            <th  style="width: 20%" class=" header">VAR</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set plan = 0 %}
                        {% set real = 0 %}
                        {% set pnr = 0 %}
                        
                        {% set items = productsReport %}
                        
                        {% for productReport in productsReport %}
                            {% set summary = productReport.getSummaryDay(dateReport,typeReport) %}
                            
                            {% set current_plan = summary['plan'] %}
                            {% set current_real = summary['real'] %}
                            
                            {% set is_next_equals = false %}
                            {% set next_item = get_next_item(loop,items) %}
                            
                            {% if next_item %}
                                {% if productReport.product == next_item.product %}
                                    {% set is_next_equals = true %}
                                {% endif %}
                            {% endif  %}
                            
                            {% if is_next_equals == true %}
                                {% set next_summary = next_item.getSummaryDay(dateReport,typeReport) %}
                                    
                                {% set plan = plan + summary['plan'] %}
                                {% set real = real + summary['real'] %}

                            {% else %}
                                {% set current_plan = current_plan + plan %}
                                {% set current_real = current_real + real %}
                                {% set current_percentage = 0 %}
                                {% if current_plan > 0 %}
                                    {% set current_percentage = (current_real * 100) / current_plan %}
                                {% endif %}
                                {% set current_pnr = current_plan - current_real %}
                                {% if current_pnr < 0 %}
                                    {% set current_pnr = 0 %}
                                {% endif %}
                                
                                <tr>
                                    <th class="content">{{ productReport.product|upper }}</th>
                                    <th class="content">{{ current_plan|myNumberFormat }}</th>
                                    <th class="content">{{ current_real|myNumberFormat }}</th>
                                    <th class="content">{{ current_percentage|myNumberFormat }}</th>
                                    <th class="content">{{ current_pnr|myNumberFormat }}</th>
                                </tr>
                                
                                {% set plan = 0 %}
                                {% set real = 0 %}
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
             </div>
            {% endif %}
            {% if showMonth %}
                <div class="six-columns twelve-columns-mobile">
                    <table class="simple-table responsive-table responsive-table-on">
                        <thead>
                            <tr>
                                <th class="text-center white-gradient" colspan="6">MES</th>
                            </tr>
                            <tr class="header-tr">
                                <th  style="width: 16%" class="header">PRODUCTO</th>
                                <th  style="width: 16%" class="header">PPTO-MES</th>
                                <th  style="width: 16%" class="header">PPTO-ACUM</th>
                                <th  style="width: 16%" class="header">REAL-ACUM</th>
                                <th  style="width: 16%" class=" header">EJEC&nbsp;(%)</th>
                                <th  style="width: 16%" class=" header">VAR</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% set plan_month = 0 %}
                            {% set plan_acumulated = 0 %}
                            {% set real_acumulated = 0 %}
                            
                            {% set items = productsReport %}

                            {% for productReport in productsReport %}
                                {% set summary = productReport.getSummaryMonth(dateReport,typeReport) %}
                                
                                {% set current_plan_month = summary['plan_month'] %}
                                {% set current_plan_acumulated = summary['plan_acumulated'] %}
                                {% set current_real_acumulated = summary['real_acumulated'] %}
                                
                                {% set is_next_equals = false %}
                                {% set next_item = get_next_item(loop,items) %}
                                
                                {% if next_item %}
                                    {% if productReport.product == next_item.product %}
                                        {% set is_next_equals = true %}
                                    {% endif %}
                                {% endif  %}
                                
                                {% if is_next_equals == true %}
                                    {% set plan_month = plan_month + summary['plan_month'] %}
                                    {% set plan_acumulated = plan_acumulated + summary['plan_acumulated'] %}
                                    {% set real_acumulated = real_acumulated + summary['real_acumulated'] %}
                                {% else %}
                                    {% set current_plan_month = current_plan_month + plan_month %}
                                    {% set current_plan_acumulated = current_plan_acumulated + plan_acumulated %}
                                    {% set current_real_acumulated = current_real_acumulated + real_acumulated %}
                                    
                                    {% set current_percentage = 0 %}
                                    {% if current_plan_acumulated > 0 %}
                                        {% set current_percentage = (current_real_acumulated * 100) / current_plan_acumulated %}
                                    {% endif %}
                                    {% set current_pnr = current_plan_acumulated - current_real_acumulated %}
                                    {% if current_pnr < 0 %}
                                        {% set current_pnr = 0 %}
                                    {% endif %}
                                    
                                    <tr>
                                        <th class="content">{{ productReport.product|upper }}</th>
                                        <th class="content">{{ current_plan_month|myNumberFormat }}</th>
                                        <th class="content">{{ current_plan_acumulated|myNumberFormat }}</th>
                                        <th class=" content">{{ current_real_acumulated|myNumberFormat }}</th>
                                        <th class=" content">{{ current_percentage|myNumberFormat }}</th>
                                        <th class=" content">{{ current_pnr|myNumberFormat }}</th>
                                    </tr>
                                    {% set plan_month = 0 %}
                                    {% set plan_acumulated = 0 %}
                                    {% set real_acumulated = 0 %}
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
             {% endif %}
         </div>
         {% if showYear  %}
         <div class="columns">
             <div class="six-columns twelve-columns-mobile">
                 <table class="simple-table responsive-table responsive-table-on">
                     <thead>
                         <tr>
                             <th class="text-center white-gradient" colspan="7">AÑO</th>
                         </tr>
                         <tr class="header-tr">
                             <th  style="width: 15%" class="header">PRODUCTO</th>
                             <th  style="width: 15%" class="header">PPTO-AÑO</th>
                             <th  style="width: 15%" class="header">PPTO-ACUM</th>
                             <th  style="width: 15%" class="header">REAL-ACUM</th>
                             <th  style="width: 15%" class=" header">EJEC&nbsp;(%)</th>
                             <th  style="width: 15%" class=" header">VAR</th>
                         </tr>
                     </thead>
                     <tbody>
                         {% set plan_year = 0 %}
                         {% set plan_acumulated = 0 %}
                         {% set real_acumulated = 0 %}
                         
                        {% set items = productsReport %}
                         
                        {% for productReport in productsReport %}
                             {% set summary = productReport.getSummaryYear(dateReport,typeReport) %}
                             
                            {% set current_plan_year = summary['plan_year'] %}
                            {% set current_plan_acumulated = summary['plan_acumulated'] %}
                            {% set current_real_acumulated = summary['real_acumulated'] %}
                             
                            {% set is_next_equals = false %}
                            {% set next_item = get_next_item(loop,items) %}
                            
                            {% if next_item %}
                                {% if productReport.product == next_item.product %}
                                    {% set is_next_equals = true %}
                                {% endif %}
                            {% endif  %}
                            
                            {% if is_next_equals == true %}
                                {% set plan_year = plan_year + summary['plan_year'] %}
                                {% set plan_acumulated = plan_acumulated + summary['plan_acumulated'] %}
                                {% set real_acumulated = real_acumulated + summary['real_acumulated'] %}
                            {% else %}
                                {% set current_plan_year = current_plan_year + plan_year %}
                                {% set current_plan_acumulated = current_plan_acumulated + plan_acumulated %}
                                {% set current_real_acumulated = current_real_acumulated + real_acumulated %}
                                
                                {% set current_percentage = 0 %}
                                {% if current_plan_acumulated > 0 %}
                                    {% set current_percentage = (current_real_acumulated * 100) / current_plan_acumulated %}
                                {% endif %}
                                {% set current_pnr = current_plan_acumulated - current_real_acumulated %}
                                {% if current_pnr < 0 %}
                                    {% set current_pnr = 0 %}
                                {% endif %}
                                 <tr>
                                     <th  class="content">{{ productReport.product|upper }}</th>
                                     <th  class="content">{{ current_plan_year|myNumberFormat }}</th>
                                     <th  class="content">{{ current_plan_acumulated|myNumberFormat }}</th>
                                     <th  class=" content">{{ current_real_acumulated|myNumberFormat }}</th>
                                     <th  class=" content">{{ current_percentage|myNumberFormat }}</th>
                                     <th  class=" content">{{ current_pnr|myNumberFormat }}</th>
                                 </tr>
                                 
                             {% set plan_year = 0 %}
                             {% set plan_acumulated = 0 %}
                             {% set real_acumulated = 0 %}
                            {% endif %}
                         {% endfor %}
                     </tbody>
                 </table>
             </div>
         </div>
         {% endif %}
         <div class="columns">
             <div class="twelve-columns-mobile">
                 <table class="simple-table responsive-table responsive-table-on">
                    <thead>
                        <tr>
                            <th class="header text-center white-gradient" colspan="5">CONSUMO DE MATERIA PRIMA</th>
                        </tr>
                        <tr>
                            <th style="width: 30%" class="header">PRODUCTO</th>
                            {%  if showDay %}
                                <th style="width: 23%" class="header">DÍA</th>
                            {% endif %}
                            {%  if showMonth %}
                                <th style="width: 23%" class=" header">MES</th>
                            {% endif %}
                            {%  if showYear %}
                                <th style="width: 23%" class=" header">AÑO</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_day = 0 %}
                        {% set total_month = 0 %}
                        {% set total_year = 0 %}
                        
                        {% set summary_total_day = 0 %}
                        {% set summary_total_month = 0 %}
                        {% set summary_total_year = 0 %}
                        
                        {% set items = rawMaterialConsumptionPlannings %}
                        
                        {% for rawMaterialConsumptionPlanning in rawMaterialConsumptionPlannings %}
                            {% set summary = rawMaterialConsumptionPlanning.getSummary(dateReport) %}
                            
                            {% set current_total_day = summary['total_day'] %}
                            {% set current_total_month = summary['total_month'] %}
                            {% set current_total_year = summary['total_year'] %}
                            
                            {% set is_next_equals = false %}
                            {% set next_item = get_next_item(loop,items) %}
                            
                            {% if next_item %}
                                {% if rawMaterialConsumptionPlanning.product == next_item.product %}
                                    {% set is_next_equals = true %}
                                {% endif %}
                            {% endif  %}
                            
                            {% if is_next_equals == true %}
                                {% set total_day = total_day + summary['total_day'] %}
                                {% set total_month = total_month + summary['total_month'] %}
                                {% set total_year = total_year + summary['total_year'] %}
                            {% else %}
                                {% set current_total_day = current_total_day + total_day %}
                                {% set current_total_month = current_total_month + total_month %}
                                {% set current_total_year = current_total_year + total_year %}
                                <tr>
                                    <th style="width: 30%" class="content">{{ rawMaterialConsumptionPlanning.product|upper }}</th>
                                    {%  if showDay %}
                                        <th style="width: 23%" class="content">{{ current_total_day|myNumberFormat }}</th>
                                    {% endif %}
                                    {%  if showMonth %}
                                        <th style="width: 23%" class=" content">{{ current_total_month|myNumberFormat }}</th>
                                    {% endif %}
                                    {%  if showYear %}
                                        <th style="width: 23%" class=" content">{{ current_total_year|myNumberFormat }}</th>
                                    {% endif %}
                                </tr>
                                {% set total_day = 0 %}
                                {% set total_month = 0 %}
                                {% set total_year = 0 %}
                                
                                {% set summary_total_day = summary_total_day + current_total_day %}
                                {% set summary_total_month = summary_total_month + current_total_month %}
                                {% set summary_total_year = summary_total_year + current_total_year %}
                            {% endif %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="empty_row">{{ "No raw material planning"|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
             </div>
             <div class="twelve-columns-mobile">
                 <table class="simple-table responsive-table responsive-table-on">
                    <thead>
                        <tr>
                            <th class="text-center white-gradient" colspan="5">CONSUMO DE SERVICIOS</th>
                        </tr>
                        <tr class="header-tr">
                            <th  style="width: 30%" class="header">PRODUCTO</th>
                            {%  if showDay %}
                                <th  style="width: 23%" class="header">DÍA</th>
                            {% endif %}
                            {%  if showMonth %}
                                <th  style="width: 23%" class=" header">MES</th>
                            {% endif %}
                            {%  if showYear %}
                                <th  style="width: 23%" class=" header">AÑO</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_day = 0 %}
                        {% set total_month = 0 %}
                        {% set total_year = 0 %}
                        
                        {% set items = consumerPlanningServices %}
                        
                        {% for consumerPlanningService in consumerPlanningServices %}
                            {% set summary = consumerPlanningService.getSummary(dateReport) %}
                            
                            {% set current_total_day = summary['total_day'] %}
                            {% set current_total_month = summary['total_month'] %}
                            {% set current_total_year = summary['total_year'] %}
                            
                            {% set is_next_equals = false %}
                            {% set next_item = get_next_item(loop,items) %}
                            
                            {% if next_item %}
                                {% if consumerPlanningService.service == next_item.service %}
                                    {% set is_next_equals = true %}
                                {% endif %}
                            {% endif  %}
                            
                            {% if is_next_equals == true %}
                                {% set total_day = total_day + summary['total_day'] %}
                                {% set total_month = total_month + summary['total_month'] %}
                                {% set total_year = total_year + summary['total_year'] %}
                            {% else %}
                                {% set current_total_day = current_total_day + total_day %}
                                {% set current_total_month = current_total_month + total_month %}
                                {% set current_total_year = current_total_year + total_year %}
                                <tr>
                                    <td style="width: 30%" class="content">{{ consumerPlanningService.service|upper }}</td>
                                    {%  if showDay %}
                                        <td style="width: 23%" class="content">{{ current_total_day|myNumberFormat }}</td>
                                    {% endif %}
                                    {%  if showMonth %}
                                        <td style="width: 23%" class=" content">{{ current_total_month|myNumberFormat }}</td>
                                    {% endif %}
                                    {%  if showYear %}
                                        <td style="width: 23%" class=" content">{{ current_total_year|myNumberFormat }}</td>
                                    {% endif %}
                                </tr>
                                {% set total_day = 0 %}
                                {% set total_month = 0 %}
                                {% set total_year = 0 %}
                            {% endif %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="empty_row">{{ "No service planning"|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
             </div>
         </div>
         <div class="columns">
             <div class="twelve-columns-mobile">
                 <table class="simple-table responsive-table responsive-table-on">
                    <thead>
                        <tr>
                            <th class="text-center white-gradient" colspan="5">PRODUCCIÓN NO REALIZADA</th>
                        </tr>
                        <tr class="header-tr">
                            <th  style="width: 30%" class="header">PRODUCTO</th>
                            {%  if showDay %}
                                <th  style="width: 23%" class="header">DÍA</th>
                            {% endif %}
                            {%  if showMonth %}
                                <th  style="width: 23%" class=" header">MES</th>
                            {% endif %}
                            {%  if showYear %}
                                <th  style="width: 23%" class=" header">AÑO</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_day = 0 %}
                        {% set total_month = 0 %}
                        {% set total_year = 0 %}
                        
                        {% set items = productsReport %}
                        
                        {% for productReport in productsReport %}
                            {% set summary = productReport.getSummaryUnrealizedProductions(dateReport) %}
                            
                            {% set current_total_day = summary['total_day'] %}
                            {% set current_total_month = summary['total_month'] %}
                            {% set current_total_year = summary['total_year'] %}
                            
                            {% set is_next_equals = false %}
                            {% set next_item = get_next_item(loop,items) %}
                            
                            {% if next_item %}
                                {% if productReport.product == next_item.product %}
                                    {% set is_next_equals = true %}
                                {% endif %}
                            {% endif  %}
                            
                            {% if is_next_equals == true %}
                                {% set total_day = total_day + summary['total_day'] %}
                                {% set total_month = total_month + summary['total_month'] %}
                                {% set total_year = total_year + summary['total_year'] %}
                            {% else %}
                                {% set current_total_day = current_total_day + total_day %}
                                {% set current_total_month = current_total_month + total_month %}
                                {% set current_total_year = current_total_year + total_year %}
                                
                                <tr>
                                    <th style="width: 30%" class="content">{{ productReport.product|upper }}</th>
                                    {%  if showDay %}
                                        <th style="width: 23%" class="content">{{ current_total_day|myNumberFormat }}</th>
                                    {% endif %}
                                    {%  if showMonth %}
                                        <th style="width: 23%" class=" content">{{ current_total_month|myNumberFormat }}</th>
                                    {% endif %}
                                    {%  if showYear %}
                                        <th style="width: 23%" class=" content">{{ current_total_year|myNumberFormat }}</th>
                                    {% endif %}
                                </tr>
                                
                                {% set total_day = 0 %}
                                {% set total_month = 0 %}
                                {% set total_year = 0 %}
                            {% endif %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="empty_row">{{ "No service planning"|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
             </div>
         </div>
         <div class="columns">
             <div class="twelve-columns-mobile">
                 <table class="simple-table responsive-table responsive-table-on">
                    <thead>
                        <tr>
                            <th class="text-center white-gradient" colspan="5">INVENTARIO</th>
                        </tr>
                        <tr class="header-tr">
                            <th  style="width: 30%" class="header">PRODUCTO</th>
                            {%  if showDay %}
                                <th  style="width: 23%" class="header">DÍA</th>
                            {% endif %}
                            {%  if showMonth %}
                                <th  style="width: 23%" class=" header">DÍA ANTERIOR</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_day = 0 %}
                        {% set total_month = 0 %}
                        
                        {% set items = productsReport %}
                        
                        {% for productReport in productsReport %}
                            {% set summary = productReport.getSummaryInventory(dateReport) %}
                            
                            {% set current_total_day = summary['total_day'] %}
                            {% set current_total_month = summary['total_month'] %}
                            
                            {% set is_next_equals = false %}
                            {% set next_item = get_next_item(loop,items) %}
                            
                            {% if next_item %}
                                {% if productReport.product == next_item.product %}
                                    {% set is_next_equals = true %}
                                {% endif %}
                            {% endif  %}
                            {% if is_next_equals == true %}
                                {% set total_day = total_day + summary['total_day'] %}
                                {% set total_month = total_month + summary['total_month'] %}
                            {% else %}
                                {% set current_total_day = current_total_day + total_day %}
                                {% set current_total_month = current_total_month + total_month %}
                                
                                <tr>
                                    <th style="width: 30%" class="content">{{ productReport.product|upper }}</th>
                                    {%  if showDay %}
                                        <th style="width: 23%" class="content">{{ current_total_day|myNumberFormat }}</th>
                                    {% endif %}
                                    {%  if showMonth %}
                                        <th style="width: 23%" class=" content">{{ current_total_month|myNumberFormat }}</th>
                                    {% endif %}
                                </tr>
                            {% endif %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="empty_row">{{ "No inventory planning"|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
             </div>
         </div>
        <div class="columns">
            {% if showDay  %}
            <div class="twelve-columns twelve-columns-mobile">
               <table class="simple-table responsive-table responsive-table-on">
                   <thead>
                       <tr>
                           <th class="header text-center white-gradient" colspan="5">OBSERVACIONES DEL DÍA</th>
                       </tr>
                       <tr>
                           <th scope="col" style="width: 20%" class="header">PRODUCTO</th>
                           <th scope="col" style="width: 80%" class="header">OBSERVACIÓN</th>
                       </tr>
                   </thead>
                   <tbody>
                       {% for productReport in productsReport %}
                           {% set summary = productReport.getSummaryDay(dateReport,typeReport) %}
                           <tr>
                               <th scope="col" style="width: 20%" class="content">{{ productReport.product|upper }}</th>
                               <th scope="col" style="width: 80%" class="content">{{ (summary['observation'] is null ? ("pequiven_seip.comment_none"|trans):summary['observation']) |upper }}</th>
                           </tr>
                       {% endfor %}
                   </tbody>
               </table>
            </div>
           {% endif %}
         </div>
 {% else %}
     <h2 class="text-center">{{ "Select the plant"|trans }}</h2>
 {% endif %}