{% block body %}
<style type="text/css">
    .messages{
        float: left;
        font-family: sans-serif;
        display: none;
    }
    .info{
        padding: 10px;
        border-radius: 10px;
        background: orange;
        color: #fff;
        font-size: 10px;
        text-align: center;
    }
    .before{
        padding: 10px;
        border-radius: 10px;
        background: blue;
        color: #fff;
        font-size: 10px;
        text-align: center;
    }
    .success{
        padding: 10px;
        border-radius: 10px;
        background: green;
        color: #fff;
        font-size: 10px;
        text-align: center;
    }
    .error{
        padding: 10px;
        border-radius: 10px;
        background: red;
        color: #fff;
        font-size: 10px;
        text-align: center;
    }
</style>

<form method="POST" id="form_tracing_add">
    <fieldset class="fieldset fields-list">
        <legend class="legend">Estandarización</legend>
            <div class="field-block button-height" >            
                {{ form_label(form.area) }}            
                {{ form_widget(form.area) }}            
            </div>  
            <div class="field-block button-height" >            
                {{ form_label(form.detection) }}            
                {{ form_widget(form.detection) }}            
            </div>  
            <div class="field-block button-height" >            
                {{ form_label(form.code) }}            
                {{ form_widget(form.code) }}            
            </div>  
            <div class="field-block button-height" >            
                {{ form_label(form.type) }}            
                {{ form_widget(form.type) }}            
            </div>  
            <div class="field-block button-height" >            
                {{ form_label(form.description) }}            
                {{ form_widget(form.description) }}            
            </div>  
            <div class="field-block button-height" >            
                <label class="label">Tratamiento</label>                                
                <input type="checkbox" name="arrangementProgram" id="arrangementProgram" value="1" class="checkbox mid-margin-left">
                <label for="checkbox-2" class="">Programa de Gestión</label>

                <input type="checkbox" name="analysis" id="analysis" value="1" class="checkbox mid-margin-left"> <label for="checkbox-2" class="">Análisis Causa Raíz</label>
            </div>    
    </fieldset>
    
    <input type="hidden" value="" id="fileName" name="fileName">

    <div class="columns">                
        <div class="six-columns six-columns-tablet twelve-columns-mobile">
            <fieldset class="fieldset" style='display:none;' id="loadPg">
                <legend class="legend">Programa de Gestión</legend>
                <label class="label">Seleccione programa de Gestión</label>
                    {{ form_label(form.arrangementProgram) }}            
                    {{ form_widget(form.arrangementProgram) }} 
            </fieldset>            
        </div>    
</form>    
        <div class="six-columns six-columns-tablet twelve-columns-mobile">
            <fieldset class="fieldset" style='display:none;' id="loadCr">
                <legend class="legend">Analisis Causa Raiz</legend>                
                <form enctype="multipart/form-data" class="formulario">                    
                    <input name="archivo" type="file" id="imagen"/>
                    <input type="button" id="subir" value="Subir archivo"/>
                </form>                
                <div class="messages"></div>
            </fieldset>
        </div>
    </div>

<script type="text/javascript">
    $('input#arrangementProgram').change(function() {        
        if($(this).is(":checked")) {
            $('#loadPg').show();                    
        }else{
            $('#loadPg').hide();        
        }
    });

    $('input#analysis').change(function() {        
        if($(this).is(":checked")) {
            $('#loadCr').show();                    
        }else{
            $('#loadCr').hide();        
        }
    }); 
         
    $(document).ready(function () {
        $("#sig_standardization_detection").select2({    
        });

        $("#sig_standardization_type").select2({    
        });

        $("#sig_standardization_arrangementProgram").select2({
            //minimumInputLength: 3,
        });
    
        //Load File
        $(".messages").hide();
        $('#subir').hide();

        //queremos que esta variable sea global
        var fileExtension = "";
        //función que observa los cambios del campo file y obtiene información
        $(':file').change(function()
        {
            //obtenemos un array con los datos del archivo
            var file = $("#imagen")[0].files[0];
            //obtenemos el nombre del archivo
            var fileName = file.name;
            //obtenemos la extensión del archivo
            fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1);
            //obtenemos el tamaño del archivo
            var fileSize = file.size;
            //obtenemos el tipo de archivo image/png ejemplo
            var fileType = file.type;
            //mensaje con la información del archivo
            showMessage("<span class='info'>Archivo para subir: "+fileName+", peso total: "+fileSize+" bytes.</span>");
            if(isImage(fileExtension) == false){
                showMessage("<span class='error'>Archivo para subir debe ser formato PDF</span>");
                $('#subir').hide();                
            }else{
                $('#subir').show();
            }
        });
     
        //Enviando formulario
        $(':button').click(function(){            
            var formData = new FormData($(".formulario")[0]);
            var message = ""; 
            
            $.ajax({
                url: 'upload',  
                type: 'POST',
                // Form data                
                data: formData,
                //necesario para subir archivos via ajax
                cache: false,
                contentType: false,
                processData: false,
                //mientras enviamos el archivo
                beforeSend: function(){
                    message = $("<span class='before'>Subiendo archivo, por favor espere...</span>");
                    showMessage(message)        
                },
                //una vez finalizado correctamente
                success: function(data){
                    message = $("<span class='success'>El archivo ha subido correctamente.</span>");
                    $('#imagen').hide();                
                    $('#subir').hide();      
                    showMessage(message);
                    $('#fileName').val(data);                    
                },
                //si ha ocurrido un error
                error: function(){
                    message = $("<span class='error'>Ha ocurrido un error.</span>");
                    showMessage(message);
                }
            });
        });
    })
    
    function showMessage(message){
        $(".messages").html("").show();
        $(".messages").html(message);
    }
     
    function isImage(extension)
    {
        switch(extension.toLowerCase()) 
        {   
            /*case 'jpg': case 'gif': case 'png': case 'jpeg':                
                return true;
            break;*/
            case 'pdf':                
                return true;
            break;
            default:                
                return false;
            break;
        }
    }  
</script>
{% endblock %}