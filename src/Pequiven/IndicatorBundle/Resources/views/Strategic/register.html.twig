{% extends 'PequivenSEIPBundle:Template:Developer/Common/formLayout.html.twig' %}

{% trans_default_domain 'PequivenIndicatorBundle' %}
{% block title %}- {{ 'form.title.addIndicatorStrategic'|trans }}{% endblock %}
{% import 'PequivenSEIPBundle:Template:Developer/Macros/actions.html.twig' as actions %}

{% block javascripts_base %}
    {{ parent() }}
    <!-- JavaScript at the bottom for fast page loading -->
    <!-- Scripts -->
    <script src="{{ asset('bundles/tecnocreacionesvzlagovernment/template/developer/js/libs/jquery-1.8.2.min.js') }}"></script>
    <script src="{{ asset('bundles/tecnocreacionesvzlagovernment/template/developer/js/setup.js') }}"></script>
{% endblock javascripts_base %}
    
{% block body %}
    <hgroup id="main-title" class="thin breadcrumb">
        <h1>
            <a href="#">{{ 'pequiven_indicator.indicators'|trans }}</a>
            <span class="icon-forward"></span>
            <span class="thin">{{ 'pequiven_indicator.add'|trans }}</span>
            <span class="icon-forward"></span>
            <span class="thin">{{ 'pequiven_indicator.strategic'|trans }}</span>
        </h1>
    </hgroup>
    
    <form action="{{ path('pequiven_indicator_menu_add_strategic') }}" {{ form_enctype(form) }} method="POST">
        <fieldset class="fieldset fields-list">
            <legend class="legend">{{ 'pequiven_indicator.indicators'|trans }}</legend>
            
            <!-- Línea Estratégica -->
            <div id="lineStrategic" class="field-block button-height">
                {{ form_label(form.lineStrategic) }}
                {{ form_widget(form.lineStrategic) }}
                {{ form_errors(form.lineStrategic) }}
                <span class="info-spot">
                    <span class="icon-info-round"></span>
                    <span class="info-bubble">{{ 'form.lineStrategic_info'|trans }}</span>
                </span>
            </div>
                
            <!-- Objetivo Estratégico -->
            <div class="field-block button-height">
                {{ form_label(form.parent) }}
                {{ form_widget(form.parent) }}
                {{ form_errors(form.parent) }}
                <span class="info-spot">
                    <span class="icon-info-round"></span>
                    <span class="info-bubble">{{ 'form.parent_strategic_info'|trans }}</span>
                </span>
            </div>
            
            <!-- Descripción -->
            <div class="field-block button-height">
                {{ form_label(form.description) }}
                {{ form_widget(form.description) }}
                {{ form_errors(form.description) }}
                <span class="info-spot">
                    <span class="icon-info-round"></span>
                    <span class="info-bubble">{{ 'form.description_info'|trans }}</span>
                </span>
            </div>
                
            <!-- Ref -->
            <div id="ref" class="field-block button-height">
                {{ form_label(form.ref) }}
                {{ form_widget(form.ref) }}
                {{ form_errors(form.ref) }}
                <span id="ref_info" class="info-spot">
                    <span class="icon-info-round"></span>
                    <span class="info-bubble">{{ 'form.ref_info'|trans }}</span>
                </span>
            </div>
            
            <!-- Peso del Indicador -->
            <!--
            <div id="weight" class="field-block button-height">
                {#{ form_label(form.weight) }}
                {{ form_widget(form.weight) }}
                {{ form_errors(form.weight) }}
                <span class="info-spot">
                    <span class="icon-info-round"></span>
                    <span class="info-bubble">{{ 'form.weight_info'|trans }#}</span>
                </span>
            </div>
            -->
                
            <!-- Meta del Indicador -->
            <div class="field-block button-height">
                    {{ form_label(form.goal) }}
                    {{ form_widget(form.goal) }}
                    {{ form_errors(form.goal) }}
                    <span class="info-spot">
                        <span class="icon-info-round"></span>
                        <span class="info-bubble">{{ 'form.goal_info'|trans }}</span>
                    </span>
            </div>
                    
            <!-- Fórmula de evaluación del indicador -->
            <div id="formula" class="field-block button-height">
                {{ form_label(form.formula) }}
                {{ form_widget(form.formula) }}
                {{ form_errors(form.formula) }}
                <span class="info-spot">
                    <span class="icon-info-round"></span>
                    <span class="info-bubble">{{ 'form.formula_info'|trans }}</span>
                </span>
            </div>

            <!-- Rango de Gestión Alto -->
            <fieldset class="fieldset">
                <legend class="legend">{{ 'form.rankArrangementTop'|trans }}</legend>
                <div class="field-block button-height">
                    {{ form_widget(form.typeArrangementRangeTypeTop) }}
                    {{ form_label(form.arrangementRangeTypeTop) }}
                    <span class="info-spot">
                        <span class="icon-info-round"></span>
                        <span class="info-bubble">{{ 'form.arrangementRangeType_info'|trans }}</span>
                    </span>
                    {{ form_widget(form.arrangementRangeTypeTop) }}

                    <span id="sectionTopBasic">
                        {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankTop) }} {{ form_widget(form.rankTop) }}
                    </span>
                    <span id="sectionTopCompound">
                        <div id="rangeTopTop">
                            {{ 'form.rankTopTop_info'|trans }}</br>
                            {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankTopTopTop) }} {{ form_widget(form.rankTopTopTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankTopTopBottom) }} {{ form_widget(form.rankTopTopBottom) }}
                        </div>
                        <div id="rangeTopBottom">
                            {{ 'form.rankTopBottom_info'|trans }}</br>
                            {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankTopBottomTop) }} {{ form_widget(form.rankTopBottomTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankTopBottomBottom) }} {{ form_widget(form.rankTopBottomBottom) }}
                        </div>
                    </span>
                </div>
            </fieldset>
                    
            <!-- Rango de Gestión Medio -->
            <fieldset class="fieldset">
                <legend class="legend">{{ 'form.rankArrangementMiddle'|trans }}</legend>
                <div class="field-block button-height">
                    {{ form_widget(form.typeArrangementRangeTypeMiddle) }}
                    {{ form_label(form.arrangementRangeTypeMiddle) }}
                    <span class="info-spot">
                        <span class="icon-info-round"></span>
                        <span class="info-bubble">{{ 'form.arrangementRangeType_info'|trans }}</span>
                    </span>
                    {{ form_widget(form.arrangementRangeTypeMiddle) }}

                    <span id="sectionMiddleBasic">
                        {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankMiddleTop) }} {{ form_widget(form.rankMiddleTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankMiddleBottom) }} {{ form_widget(form.rankMiddleBottom) }}
                    </span>
                    <span id="sectionMiddleCompound">
                        <div id="rangeMiddleTop">
                            {{ 'form.rankMiddleTop_info'|trans }}</br>
                            {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankMiddleTopTop) }} {{ form_widget(form.rankMiddleTopTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankMiddleTopBottom) }} {{ form_widget(form.rankMiddleTopBottom) }}
                        </div>
                        <div id="rangeMiddleBottom">
                            {{ 'form.rankMiddleBottom_info'|trans }}</br>
                            {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankMiddleBottomTop) }} {{ form_widget(form.rankMiddleBottomTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankMiddleBottomBottom) }} {{ form_widget(form.rankMiddleBottomBottom) }}
                        </div>
                    </span>
                </div>
            </fieldset>
            
            <!-- Rango de Gestión Bajo -->
            <fieldset class="fieldset">
                <legend class="legend">{{ 'form.rankArrangementBottom'|trans }}</legend>
                <div class="field-block button-height">
                    {{ form_widget(form.typeArrangementRangeTypeBottom) }}
                    {{ form_label(form.arrangementRangeTypeBottom) }}
                    <span class="info-spot">
                        <span class="icon-info-round"></span>
                        <span class="info-bubble">{{ 'form.arrangementRangeType_info'|trans }}</span>
                    </span>
                    {{ form_widget(form.arrangementRangeTypeBottom) }}

                    <span id="sectionBottomBasic">
                        {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankBottom) }} {{ form_widget(form.rankBottom) }}
                    </span>
                    <span id="sectionBottomCompound">
                        <div id="rangeBottomTop">
                            {{ 'form.rankBottomTop_info'|trans }}</br>
                            {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankBottomTopTop) }} {{ form_widget(form.rankBottomTopTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankBottomTopBottom) }} {{ form_widget(form.rankBottomTopBottom) }}
                        </div>
                        <div id="rangeBottomBottom">
                            {{ 'form.rankBottomBottom_info'|trans }}</br>
                            {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankBottomBottomTop) }} {{ form_widget(form.rankBottomBottomTop) }} y {{ 'form.textResInd'|trans }}{{ form_widget(form.opRankBottomBottomBottom) }} {{ form_widget(form.rankBottomBottomBottom) }}
                        </div>
                    </span>
                </div>
            </fieldset>
            {{ actions.create_formModal() }}
        </fieldset>
    {{ form_rest(form) }}
    </form>
    {% block javascript %}
        <script type="text/javascript">
            $(document).ready(function()
            {
                var selectLineStrategic = $("#pequiven_indicator_strategic_registration_lineStrategic"),//Select de Línea Estratégica
                    selectObjetiveStrategic = $("#pequiven_indicator_strategic_registration_parent"),//Select de Objetivo Estratégico
                    selectFormula = $("#pequiven_indicator_strategic_registration_formula"),//Select de Fórmula
                    inputRef = $("#pequiven_indicator_strategic_registration_ref"),//Input de Ref
                    inputGoal = $("#pequiven_indicator_strategic_registration_goal"),//Input de Meta
                    selectArrangementRangeTypeTop = $("#pequiven_indicator_strategic_registration_arrangementRangeTypeTop"),//Select de Tipo de Rango Alto
                    selectArrangementRangeTypeMiddle = $("#pequiven_indicator_strategic_registration_arrangementRangeTypeMiddle"),//Select de Tipo de Rango Alto
                    selectArrangementRangeTypeBottom = $("#pequiven_indicator_strategic_registration_arrangementRangeTypeBottom"),//Select de Tipo de Rango Alto
                    inputHiddenRefParent = $("#pequiven_indicator_strategic_registration_refObjetive"),//Input Hidden de la Referencia del Objetivo
                    sectionTopBasic = $("#sectionTopBasic"),//Input Hidden de la Referencia del Objetivo
                    sectionTopCompound = $("#sectionTopCompound"),//Input Hidden de la Referencia del Objetivo
                    sectionMiddleBasic = $("#sectionMiddleBasic"),//Input Hidden de la Referencia del Objetivo
                    sectionMiddleCompound = $("#sectionMiddleCompound"),//Input Hidden de la Referencia del Objetivo
                    sectionBottomBasic = $("#sectionBottomBasic"),//Input Hidden de la Referencia del Objetivo
                    sectionBottomCompound = $("#sectionBottomCompound"),//Input Hidden de la Referencia del Objetivo
                    inputRefParent = $("#pequiven_objetive_strategic_registration_ref",window.parent.document),//Input de Referencia de la ventana Padre del Objetivo
                    inputHiddenTypeArrangementRangeTop = $("#pequiven_indicator_strategic_registration_typeArrangementRangeTypeTop"),//Input Hidden del tipo de rango de gestión alto
                    inputHiddenTypeArrangementRangeMiddle = $("#pequiven_indicator_strategic_registration_typeArrangementRangeTypeMiddle"),//Input Hidden del tipo de rango de gestión medio
                    inputHiddenTypeArrangementRangeBottom = $("#pequiven_indicator_strategic_registration_typeArrangementRangeTypeBottom"),//Input Hidden del tipo de rango de gestión bajo
                    inputRankTop = $("#pequiven_indicator_strategic_registration_rankTop"),//Input de rankTop
                    inputRankTopTopTop = $("#pequiven_indicator_strategic_registration_rankTopTopTop"),//Input de rankTopTopTop
                    inputRankTopTopBottom = $("#pequiven_indicator_strategic_registration_rankTopTopBottom"),//Input de rankTopTopBottom
                    inputRankTopBottomTop = $("#pequiven_indicator_strategic_registration_rankTopBottomTop"),//Input de rankTopBottomTop
                    inputRankTopBottomBottom = $("#pequiven_indicator_strategic_registration_rankTopBottomBottom"),//Input de rankTopBottomBottom
                    inputRankMiddleTop = $("#pequiven_indicator_strategic_registration_rankMiddleTop"),//Input de rankMiddleTop
                    inputRankMiddleBottom = $("#pequiven_indicator_strategic_registration_rankMiddleBottom"),//Input de rankMiddleBottom
                    inputRankMiddleTopTop = $("#pequiven_indicator_strategic_registration_rankMiddleTopTop"),//Input de rankMiddleTopTop
                    inputRankMiddleTopBottom = $("#pequiven_indicator_strategic_registration_rankMiddleTopBottom"),//Input de rankMiddleTopBottom
                    inputRankMiddleBottomTop = $("#pequiven_indicator_strategic_registration_rankMiddleBottomTop"),//Input de rankMiddleBottomTop
                    inputRankMiddleBottomBottom = $("#pequiven_indicator_strategic_registration_rankMiddleBottomBottom"),//Input de rankMiddleBottomBottom
                    inputRankBottom = $("#pequiven_indicator_strategic_registration_rankBottom"),//Input de rankBottom
                    inputRankBottomTopTop = $("#pequiven_indicator_strategic_registration_rankBottomTopTop"),//Input de rankBottomTopTop
                    inputRankBottomTopBottom = $("#pequiven_indicator_strategic_registration_rankBottomTopBottom"),//Input de rankBottomTopBottom
                    inputRankBottomBottomTop = $("#pequiven_indicator_strategic_registration_rankBottomBottomTop"),//Input de rankBottomBottomTop
                    inputRankBottomBottomBottom = $("#pequiven_indicator_strategic_registration_rankBottomBottomBottom")//Input de rankBottomBottomBottom
            ;
           charge();
           
           function charge(){
               //Inicializamos el select de Línea Estratégica
                chargeSelect2LineStrategic();
                
                //Inicializamos el select2 de Objetivo Estratégico
               chargeSelect2ObjetiveStrategic();
               
               //Inicializamos el select2 de Fórmula
               selectFormula.select2({
                   placeholder: '{{ 'form.messages.selectFormulaPlaceholder'|trans ({}, 'PequivenIndicatorBundle') }}',
               });
       
               //Incializamos el formato numerico para el input de Meta
               inputGoal.number(true,3,',','.');
               
               //Cargamos la referencia del objetivo que se esta creando en el inputHiddenRefParent
               inputHiddenRefParent.val(inputRefParent.val());
               
               //Inicializamos el formato numerico para el input de Rango Alto
               inputRankTop.number(true,3,',','.');
               inputRankTopTopTop.number(true,3,',','.');
               inputRankTopTopBottom.number(true,3,',','.');
               inputRankTopBottomTop.number(true,3,',','.');
               inputRankTopBottomBottom.number(true,3,',','.');
               inputRankMiddleTop.number(true,3,',','.');
               inputRankMiddleBottom.number(true,3,',','.');
               inputRankMiddleTopTop.number(true,3,',','.');
               inputRankMiddleTopBottom.number(true,3,',','.');
               inputRankMiddleBottomTop.number(true,3,',','.');
               inputRankMiddleBottomBottom.number(true,3,',','.');
               inputRankBottom.number(true,3,',','.');
               inputRankBottomTopTop.number(true,3,',','.');
               inputRankBottomTopBottom.number(true,3,',','.');
               inputRankBottomBottomTop.number(true,3,',','.');
               inputRankBottomBottomBottom.number(true,3,',','.');
               
               sectionTopBasic.hide();
               sectionTopCompound.hide();
               sectionMiddleBasic.hide();
               sectionMiddleCompound.hide();
               sectionBottomBasic.hide();
               sectionBottomCompound.hide();
           }
           
           //INICIO INTERACCIÓN USUARIO
           
           //Al seleccionar alguna opción en el select de Línea Estratégica
            selectLineStrategic.on("select2-selecting", function(e) {                
                displayObjetiveStrategicFromLineStrategic(e);//Actualizamos los Objetivos Estratégicos
            })
            selectLineStrategic.change(function() {
               inputRef.val("");
            });
            
            //AL seleccionar alguna opción en el select de Objetivo Estratégico
            selectObjetiveStrategic.on("select2-selecting", function(e) {
                //Actualizamos la referencia del indicador
                displayIndicatorRef(e);
            })
           
           selectArrangementRangeTypeTop.click(function() {
                if ($("input[id='pequiven_indicator_strategic_registration_arrangementRangeTypeTop_1']").is(':checked')) {
                    sectionTopBasic.show();
                    sectionTopCompound.hide();
                    inputHiddenTypeArrangementRangeTop.val("TOP_BASIC");
                 }
                 else {
                    sectionTopBasic.hide();
                    sectionTopCompound.show();
                    inputHiddenTypeArrangementRangeTop.val("TOP_COMPOUND");
                 }
           });
           
           selectArrangementRangeTypeMiddle.click(function() {
                if ($("input[id='pequiven_indicator_strategic_registration_arrangementRangeTypeMiddle_2']").is(':checked')) {
                    sectionMiddleBasic.show();
                    sectionMiddleCompound.hide();
                    inputHiddenTypeArrangementRangeMiddle.val("MIDDLE_BASIC");
                 }
                 else {
                    sectionMiddleBasic.hide();
                    sectionMiddleCompound.show();
                    inputHiddenTypeArrangementRangeMiddle.val("MIDDLE_COMPOUND");
                 }
           });
           
           selectArrangementRangeTypeBottom.click(function() {
                if ($("input[id='pequiven_indicator_strategic_registration_arrangementRangeTypeBottom_3']").is(':checked')) {
                    sectionBottomBasic.show();
                    sectionBottomCompound.hide();
                    inputHiddenTypeArrangementRangeBottom.val("BOTTOM_BASIC");
                 }
                 else {
                    sectionBottomBasic.hide();
                    sectionBottomCompound.show();
                    inputHiddenTypeArrangementRangeBottom.val("BOTTOM_COMPOUND");
                 }
           });
           
           //FIN INTERACCIÓN USUARIO
           
           //Función que muestra los objetivos estratégicos de acuerdo a la línea estratégica seleccionada
            function displayObjetiveStrategicFromLineStrategic(e){
                var data = {
                   lineStrategicId: $.trim(e.val),
               };
               $.ajax({
                   type: 'post',
                   url: '{{ path("select_objetiveStrategicFromLineStrategic") }}',
                   data: data,
                   success: function(data) {
                        $('#pequiven_indicator_strategic_registration_parent option[value]').remove();
                        $('#pequiven_indicator_strategic_registration_parent option').remove();
                        selectObjetiveStrategic.append('<option></option>');
                        if(typeof data[0].empty === 'undefined'){
                            for(var i=0, total = data.length; i<total; i++){
                                selectObjetiveStrategic.append('<option value="' + data[i].id + '">' + data[i].description + '</option>');
                            }
                            chargeSelect2ObjetiveStrategic("full");
                        } else{
                            if(typeof data[0].initial === 'undefined'){
                                chargeSelect2ObjetiveStrategic("empty");
                            } else{
                                chargeSelect2ObjetiveStrategic("initial");
                            }
                        }
                   }
                });
            }
           
           //Función que muestra el Número de Referencia del indicador a crear, de acuerdo a la línea estratégica seleccionada
           function displayIndicatorRef(e){
                var data = {
                    objetiveStrategicId: $.trim(e.val)
                };
                $.ajax({
                    type: 'post',
                    url: '{{ path("displayRefIndicatorStrategic") }}',
                    data: data,
                    success: function(data) {
                        inputRef.val(data[0].ref);
                    }
                 });
           }
           
           //Función que carga el select2 de Línea Estratégica
            function chargeSelect2LineStrategic(type){
                selectLineStrategic.select2({
                    placeholder: '{{ 'form.messages.selectLineStrategicPlaceholder'|trans }}',
                    formatNoMatches: function(term) {
                        if(type == 'full'){
                            return "{{ 'form.messages.selectLineStrategicFormatNoMatcher'|trans }}";
                        } else{
                            return "{{ 'form.messages.selectLineStrategicFormatNoResult'|trans }}";
                        }
                    }
                });
            }
            
            //Función que carga el select2 de Objetivo Estratégico
            function chargeSelect2ObjetiveStrategic(type){
                selectObjetiveStrategic.select2({
                    placeholder: '{{ 'form.messages.selectObjetiveStrategicPlaceholder'|trans }}',
                    formatNoMatches: function(term) {
                        if(type == 'full'){
                            return "{{ 'form.messages.selectObjetiveStrategicFormatNoMatcher'|trans }}";
                        } else if (type == 'empty'){
                            return "{{ 'form.messages.selectObjetiveStrategicFormatNoResult'|trans }}";
                        } else {
                            return "{{ 'form.messages.selectObjetiveStrategicFormatNoMatcher'|trans }}";
                        }
                    }
                });
            }
            });
        </script>
    {% endblock javascript %}
    
{% endblock body %}
