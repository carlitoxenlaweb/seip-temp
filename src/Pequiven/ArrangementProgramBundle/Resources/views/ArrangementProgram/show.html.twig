{% extends 'PequivenSEIPBundle:Template:Developer/Common/formLayoutShow.html.twig' %}

{% trans_default_domain 'PequivenArrangementProgramBundle' %}

{% import 'PequivenSEIPBundle:Template:Developer/Macros/buttons.html.twig' as buttons %}

{% block body -%}
<div>
    <hgroup id="main-title" class="thin breadcrumb">
        <h1>
            <a href="{{ path('pequiven_seip_arrangementprogram_index') }}">{{ 'pequiven.arrangement_program.arrangement_program'|trans }}</a>
            <span class="icon-forward"></span>
            <span class="thin">{{ entity.getTypeLabel|trans }}</span>
            <span class="icon-forward"></span>
            <span class="thin">{{ 'pequiven.show'|trans({},'messages') }}</span>
        </h1>
    </hgroup>
        
    <fieldset class="fieldset">
        <legend class="legend">{{ 'pequiven.arrangement_program.arrangement_program'|trans }}&nbsp;<b>{{ entity.getTypeLabel|trans }}</b></legend>
        
         <div class="columns">
             <div class="new-row-mobile six-columns six-columns-tablet twelve-columns-mobile">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.ref'|trans({},'messages') }}</label>
                    {{ entity.ref }}
                </p>
             </div>
            <div class="new-row-tablet new-row-mobile six-columns twelve-columns-tablet">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.period'|trans }}</label>
                    {{ entity.period }}
                </p>
            </div>
                
            <div class="new-row new-row-mobile six-columns six-columns-tablet twelve-columns-mobile">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.process'|trans }}</label>
                    {{ entity.process }}
                </p>
                
            </div>
            <div class="new-row-tablet new-row-mobile six-columns twelve-columns-tablet">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.category_arrangement_program'|trans }}</label>
                    {{ entity.categoryArrangementProgram }}
                </p>
            </div>
                
            <div class="new-row new-row-mobile six-columns six-columns-tablet twelve-columns-mobile">
                {% if entity.type == constant('Pequiven\\ArrangementProgramBundle\\Entity\\ArrangementProgram::TYPE_ARRANGEMENT_PROGRAM_TACTIC') %}
                    <p class="inline-label">
                        <label class="label">{{ 'pequiven.arrangement_program.location'|trans }}</label>
                        {{ entity.tacticalObjective.gerencia.complejo }}
                    </p>
                {% endif %}
                {% if entity.type == constant('Pequiven\\ArrangementProgramBundle\\Entity\\ArrangementProgram::TYPE_ARRANGEMENT_PROGRAM_OPERATIVE') %}
                    <p class="inline-label">
                        <label class="label">{{ 'pequiven.arrangement_program.location'|trans }}</label>
                        {{ entity.operationalObjective.gerencia.complejo }}
                    </p>
                {% endif %}
            </div>
            <div class="new-row-tablet new-row-mobile six-columns twelve-columns-tablet">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.management'|trans }}</label>
                    {{ entity.tacticalObjective.gerencia }}
                </p>
            </div>
                
            <div class="new-row new-row-mobile six-columns six-columns-tablet twelve-columns-mobile">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.tactical_objective'|trans }}</label>
                    {{ entity.tacticalObjective }}
                </p>        
            </div>
            {% if entity.type == constant('Pequiven\\ArrangementProgramBundle\\Entity\\ArrangementProgram::TYPE_ARRANGEMENT_PROGRAM_OPERATIVE') %}
                <div class="new-row-tablet new-row-mobile six-columns twelve-columns-tablet">
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.operational_objective'|trans }}</label>
                            {{ entity.operationalObjective }}
                        </p>
                </div>
            {% endif %}
                
            <div class="new-row new-row-mobile six-columns six-columns-tablet twelve-columns-mobile">
                <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.responsibles'|trans }}</label>
                    {% for responsible in entity.responsibles %}
                        {{ responsible }}{% if loop.last == false %},{% else %}.{% endif %}
                    {% endfor %}
                </p>
             
            </div>
            
                
            <div class="new-row-tablet new-row-mobile six-columns twelve-columns-tablet">
                 <p class="inline-label">
                    <label class="label">{{ 'pequiven.arrangement_program.status.status'|trans }}</label>
                    <small class="tag">{{ entity.labelStatus|trans }}</small>
                </p>
            </div>
              
        </div>
        <br/><br/>
        <p class="inline-label">
            <label class="label">{{ 'pequiven.arrangement_program.advances'|trans }}</label>
            {% set summary = entity.summary %}
            {% set advances = summary['advances'] %}
            {% set advancesClass = 'red-gradient' %}
            {% if advances >= 50 %}
                {% set advancesClass = 'orange-gradient' %}

            {% elseif advances == 100 %}
                {% set advancesClass = 'green-gradient' %}
            {% endif %}
            <span style="max-width: 400px" class="progress" data-progress-options='{"size":false,"barClasses":["{{ advancesClass }}","glossy"],"innerMarks":25,"topMarks":25,"topLabel":"[value]%","bottomMarks":[{"value":0,"label":"{{ 'pequiven.advances.nope'|trans({},'messages') }}"},{"value":50,"label":"{{ 'pequiven.advances.better'|trans({},'messages') }}"},{"value":100,"label":"{{ 'pequiven.advances.complete'|trans({},'messages') }}"}],"insetExtremes":true}'>{{ advances }}%</span>
        </p>
    </fieldset>
    
    {% include 'PequivenArrangementProgramBundle:ArrangementProgram:show/timelines.html.twig' %}
    
    
    <h4>Top tabs</h4>

    <div class="standard-tabs margin-bottom" id="add-tabs">

            <ul class="tabs">
                <li class="active"><a href="#tab-1">{{ 'pequiven.history'|trans({},'messages') }}</a></li>
                <li><a href="#tab-2">{{ 'pequiven.details'|trans({},'messages') }}</a></li>
            </ul>

            <div class="tabs-content">

                    <div id="tab-1" class="with-padding">

                            <table class="simple-table responsive-table tables-extras" >
                                <thead>
                                    <tr>
                                        <th scope="col" width="60%">{{ 'pequiven.table.header.event'|trans({},'messages') }}</th>
                                        <th scope="col" width="20%" class="hide-on-mobile">{{ 'pequiven.table.header.user'|trans({},'messages') }}</th>
                                        <th scope="col" width="20%" class="hide-on-mobile-portrait">{{ 'pequiven.table.header.date'|trans({},'messages') }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for history in entity.histories %}
                                        <tr ng-repeat="goal in goals">
                                            <th scope="row">
                                                {{ history.event }}<br>
                                                <small>{{ history.comment }}</small>
                                            </th>
                                            <td>
                                                {{ history.user.firstName ~ " "~ history.user.lastName }} <small class="tag">{{ " (" ~ history.user.username ~ ")" }}</small>
                                            </td>
                                            <td>
                                                {{ history.createdAt|date(appConfiguration.generalDateFormat) }}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                    </div>

                    <div id="tab-2" class="with-padding">
                        {% set configuration = entity.tacticalObjective.gerencia.configuration %}
                        {% set validConfiguration = false %}
                        {% if configuration != null %}
                            {% set validConfiguration = true %}
                        {% endif %}
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.responsible_for_review'|trans }}</label>
                            {% if validConfiguration == true %}
                                {% for userReviser in configuration.arrangementProgramUserToRevisers %}
                                    <small class="tag orange-bg">{{ userReviser }}</small>{% if loop.last == false %},{% else %}.{% endif %}
                                {% else %}
                                    <small class="tag red-bg">{{ 'pequiven.arrangement_program.you_must_assign_responsible'|trans }}</small>
                                {% endfor %}
                            {% else %}
                                <small class="tag red-bg">{{ 'pequiven.arrangement_program.you_must_assign_config'|trans }}</small>
                            {% endif %}
                        </p>
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.manager_approval'|trans }}</label>
                            {% if validConfiguration == true %}
                                {% if entity.type == constant('Pequiven\\ArrangementProgramBundle\\Entity\\ArrangementProgram::TYPE_ARRANGEMENT_PROGRAM_TACTIC') %}
                                    {% if configuration.arrangementProgramUserToApproveTactical %}
                                        <small class="tag">{{ configuration.arrangementProgramUserToApproveTactical }}</small>
                                    {% else %}
                                        <small class="tag red-bg">{{ 'pequiven.arrangement_program.you_must_assign_responsible'|trans }}</small>
                                    {% endif%}
                                {% endif %}
                                {% if entity.type == constant('Pequiven\\ArrangementProgramBundle\\Entity\\ArrangementProgram::TYPE_ARRANGEMENT_PROGRAM_OPERATIVE') %}
                                    {% if configuration.arrangementProgramUserToApproveTactical %}
                                        <small class="tag">{{ configuration.arrangementProgramUserToApproveOperative }}</small>
                                    {% else %}
                                        <small class="tag red-bg">{{ 'pequiven.arrangement_program.you_must_assign_responsible'|trans }}</small>
                                    {% endif%}
                                {% endif %}
                            {% else %}
                                <small class="tag red-bg">{{ 'pequiven.arrangement_program.you_must_assign_config'|trans }}</small>
                            {% endif %}
                        </p>
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.reviewed_by'|trans }}</label>
                            {{ entity.details.reviewedBy ? entity.details.reviewedBy : 'pequiven.arrangement_program.no_revison_date'|trans }}
                        </p>
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.revision_date'|trans }}</label>
                            {{ entity.details.revisionDate ? entity.details.revisionDate|date(appConfiguration.generalDateFormat) : 'pequiven.arrangement_program.no_revison_date'|trans }}
                        </p>
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.approved_by'|trans }}</label>
                            {{ entity.details.approvedBy ? entity.details.approvedBy : 'pequiven.arrangement_program.no_approval_date'|trans }}
                        </p>
                        <p class="inline-label">
                            <label class="label">{{ 'pequiven.arrangement_program.approval_date'|trans }}</label>
                            {{ entity.details.approvalDate ? entity.details.approvalDate|date(appConfiguration.generalDateFormat) : 'pequiven.arrangement_program.no_approval_date'|trans }}
                        </p>
                        
                    </div>
            </div>

    </div>
    
<script type="text/javascript">
    $(function() {
            $('a.showPopup').click(function(e) {
                e.preventDefault();
                var $this = $(this);
                var horizontalPadding = 10;
                var verticalPadding = 10;
                var width = 1200;
                var heigth = 600;
                $('<iframe id="site" src="' + this.href + '" style="padding:0"/>').dialog({
                    title: ($this.attr('title')) ? $this.attr('title') : 'Site',
                    autoOpen: true,
                    width: width,
                    height: heigth,
                    modal: true,
                    resizable: true,
                    autoResize: true,
                    overlay: {
                        opacity: 0.5,
                        background: "black"
                    }
                }).width(width - horizontalPadding).height(heigth - verticalPadding);
            });
    });
    $(function(){
        {% if app.session.flashbag.has('autoOpenOnSave') %}
            {% set tmpClear = app.session.flashbag.get('autoOpenOnSave') %}
            $('#arrangementGoalDetailsPop').click();
        {% endif %}
    });
</script>
 

</div>

<br /><br />

<p class="button-height align-right">
    {{ buttons.generic_confirm(path('arrangementprogram_revised', { 'id': entity.id }),('pequiven.arrangement_program.buttons.approved'|trans),{'gradient':'green-gradient','icon':'icon-tick','content':('pequiven.arrangement_program.questions.approved'|trans)}) }}
    {{ buttons.generic_confirm(path('arrangementprogram_approved', { 'id': entity.id }),('pequiven.arrangement_program.buttons.revised'|trans),{'icon':'icon-like','content':('pequiven.arrangement_program.questions.revised'|trans)}) }}
    {{ buttons.generic(path('arrangementprogram_edit', { 'id': entity.id }),('pequiven.edit'|trans({},'messages'))) }}
    {{ buttons.delete(path('arrangementprogram_delete', { 'id': entity.id })) }}
</p>

{% endblock %}

{% block javascript %}
    <script type="text/javascript">
        jQuery(document).ready(function(){
             $('.tables-extras').tablesorter();
             // Progress
            $('.progress').progress();
        });
    </script>
{% endblock javascript %}
