{% extends 'PequivenSEIPBundle:Template:Developer/Common/formLayout.html.twig' %}

{% trans_default_domain 'PequivenArrangementProgramBundle' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/tecnocreacionesvzlagovernment/template/developer/css/styles/table3860.css?v=1') }}">
{% endblock stylesheets %}
{% import 'PequivenSEIPBundle:Template:Developer/Macros/actions.html.twig' as actions %}

{% block body -%}
    <hgroup id="main-title" class="thin breadcrumb">
        <h1>
            <a href="{{ path('pequiven_arrangementprogram') }}">{{ 'pequiven.arrangement_program.arrangement_program'|trans }}</a>
            <span class="icon-forward"></span>
            <span class="thin">{{ 'pequiven.add'|trans({},'messages') }}</span>
        </h1>
    </hgroup>
        
    {{ form_start(form,{'attr':{ 'ng-controller':"ArrangementProgramController" } }) }}
     
        <fieldset class="fieldset fields-list">
            <legend class="legend">{{ 'pequiven.arrangement_program.arrangement_program'|trans }}</legend>
            <div class="field-block button-height">
                {{ form_label(form.period) }}
                {{ form_widget(form.period) }}
                {{ form_errors(form.period) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.categoryArrangementProgram) }}
                {{ form_widget(form.categoryArrangementProgram) }}
                {{ form_errors(form.categoryArrangementProgram) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.tacticalObjective) }}
                {{ form_widget(form.tacticalObjective) }}
                {{ form_errors(form.tacticalObjective) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.operationalObjective) }}
                {{ form_widget(form.operationalObjective) }}
                {{ form_errors(form.operationalObjective) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.operatingIndicator) }}
                {{ form_widget(form.operatingIndicator) }}
                {{ form_errors(form.operatingIndicator) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.location) }}
                {{ form_widget(form.location) }}
                {{ form_errors(form.location) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.process) }}
                {{ form_widget(form.process) }}
                {{ form_errors(form.process) }}
            </div>
            <div class="field-block button-height">
                {{ form_label(form.responsible) }}
                {{ form_widget(form.responsible) }}
                {{ form_errors(form.responsible) }}
            </div>
        </fieldset>
            <div id="dialog-form" title="{{ "pequiven.goals.goals"|trans }}">
                <h4>{{ "pequiven.goals.goals"|trans }}</h4>
                <div ng-include="template.url" onload="templateLoad(template)"></div>
            </div>
            
            <table class="simple-table responsive-table" id="sorting-example2">
                <thead>
                        <tr>
                            <th scope="col">{{ 'seip.table.header.name'|trans }}</th>
                            <th scope="col" width="15%" class="hide-on-mobile">{{ 'seip.table.header.type_goal'|trans }}</th>
                            <th scope="col" width="15%" class="hide-on-mobile-portrait">{{ 'seip.table.header.start_date'|trans }}</th>
                            <th scope="col" width="15%" class="hide-on-tablet">{{ 'seip.table.header.end_date'|trans }}</th>
                            <th scope="col" width="15%" class="hide-on-tablet">{{ 'seip.table.header.weight'|trans }}</th>
                            <th scope="col" width="120" class="align-right">{{ 'seip.table.header.responsible'|trans }}</th>
                            <th scope="col" width="120" class="align-right">{{ 'seip.table.header.actions'|trans }}</th>
                        </tr>
                </thead>
                <tfoot>
                    <tr>
                        <td colspan="7">
                            [[ goals.length ]] entries found
                        </td>
                    </tr>
                </tfoot>
                <tbody>
                    <tr ng-repeat="goal in goals">
                        <th scope="row">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_name" value="[[ goal.name ]]">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_typeGoal" value="[[ goal.type_goal ]]">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_startDate" value="[[ goal.start_date ]]">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_endDate" value="[[ goal.end_date ]]">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_responsible" value="[[ goal.responsible ]]">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_weight" value="[[ goal.weight ]]">
                            <input type="hidden" name="arrangementprogram_timelines_0_goals_[[ $index ]]_observations" value="[[ goal.observations ]]">
                            [[ goal.name ]]<br>
                            <small>[[ goal.observations ]]</small>
                        </th>
                        <td>[[ goal.type_goal ]]</td>
                        <td>[[ goal.start_date ]]</td>
                        <td>[[ goal.end_date ]]</td>
                        <td>[[ goal.weight ]]</td>
                        <td><small class="tag">[[ goal.responsible ]]</small></td>
                        <td class="align-right vertical-center">
                            <span class="button-group compact">
                                <a href="javascript:void(0);" class="button icon-pencil">Edit</a>
                                <a href="javascript:void(0);" class="button icon-trash with-tooltip confirm" title="Delete"></a>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <a class="button" href="#" ng-click="loadTemplateMeta()">AÃ±adir meta</a>
              
            <script type="text/javascript">
                
                var prototypeForm = {
                        name: 'arrangementprogram_timelines_0_goals___name___name',
                        typeGoal: 'arrangementprogram_timelines_0_goals___name___typeGoal',
                        startDate: 'arrangementprogram_timelines_0_goals___name___startDate',
                        endDate: 'arrangementprogram_timelines_0_goals___name___endDate',
                        responsible: 'arrangementprogram_timelines_0_goals___name___responsible',
                        weight: 'arrangementprogram_timelines_0_goals___name___weight',
                        observations: 'arrangementprogram_timelines_0_goals___name___observations'
                    };
                
                var $collectionHolder;

                // setup an "add a tag" link
                var $addTagLink = $('#add-form-goal');
                //var $newLinkLi = $('<li></li>').append($addTagLink);
                jQuery(document).ready(function() {
                    
                    // Get the ul that holds the collection of tags
                    $collectionHolder = $('ul.tags');
                    
                    // add a delete link to all of the existing tag form li elements
                    $collectionHolder.find('li').each(function() {
                        addTagFormDeleteLink($(this));
                    });
                    

                    // add the "add a tag" anchor and li to the tags ul
                    //$collectionHolder.append($newLinkLi);
                    
                    // count the current form inputs we have (e.g. 2), use that as the new
                    // index when inserting a new item (e.g. 2)
                    $collectionHolder.data('index', $collectionHolder.find(':input').length);

                    $addTagLink.on('click', function(e) {
                        // prevent the link from creating a "#" on the URL
                        e.preventDefault();
                        // add a new tag form (see next code block)
                        addTagForm($collectionHolder);
                    });
                    
                    function addTagForm($collectionHolder) {
                        // Get the data-prototype explained earlier
                        var prototype = $collectionHolder.data('prototype');

                        // get the new index
                        var index = $collectionHolder.data('index');

                        // Replace '__name__' in the prototype's HTML to
                        // instead be a number based on how many items we have
                        var newForm = prototype.replace(/__name__/g, index);
                        var idTypeGoal = prototypeForm.typeGoal.replace(/__name__/g, index);
                        var idResponsible = prototypeForm.responsible.replace(/__name__/g, index);

                        // increase the index with one for the next item
                        $collectionHolder.data('index', index + 1);

                        addTab(newForm);
                        
                        $("#"+idTypeGoal).select2();
                        $("#"+idResponsible).select2();
                    }
                    
                });
                
                    // Tabs adding/removing
                    var tabsAdded = [];

                    // Add a tab
                    function addTab(content)
                    {
                            // New tab id
                            var tabId = 'new-tab'+tabsAdded.length;

                            // Register tab
                            tabsAdded.push(tabId);
                            var $removeFormA = '<a href="#" class="pull-right" onclick="removeTabs(\''+tabId+'\')">{{ "pequiven.goals.delete_this_goal"|trans }}</a>';

                            // Create
                            $('#add-tabs').addTab(tabId, '{{ "pequiven.goals.goal"|trans }} '+tabsAdded.length,$removeFormA+ content);
                    };
                    // Remove dynamically created tabs
		function removeTabs(id)
		{
                    if(tabsAdded.length > 0)
                    {
                        $('#'+id).removeTab();
                    }
		};
            </script>
            
        {{ form_rest(form) }}
        {{ actions.create() }}
    {{ form_end(form) }}

{% endblock %}
